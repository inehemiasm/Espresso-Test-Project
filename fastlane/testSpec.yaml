version: 0.1
 
# Phases are collection of commands that get executed on Device Farm.
phases:
  # The install phase includes commands that install dependencies that your tests use.
  # Default dependencies for testing frameworks supported on Device Farm are already installed.
  install:
    commands:
 
  # The pre-test phase includes commands that setup your test environment.
  pre_test:
    commands:
      
  # The test phase includes commands that run your test suite execution.
  test:
    commands:
      # By default, the following command is used by Device Farm to run your Instrumentation test.
      # Alternatively, You may specify your customized command.
      # Note: For most use cases, the default command works fine.
      # Please refer "https://developer.android.com/studio/test/command-line#RunTestsDevice" for more options on running instrumentation tests from the command line.
      - echo "Start Instrumentation test"
      - adb -s $DEVICEFARM_DEVICE_UDID shell am instrument -r -w --no-window-animation $DEVICEFARM_TEST_PACKAGE_NAME/$DEVICEFARM_TEST_PACKAGE_RUNNER 2>&1 | tee $DEVICEFARM_LOG_DIR/instrument.log
      # The below command is used to detect if any of the instrumentation tests have failed and therefore is used in marking the tests result as PASSED/FAILED
      - "! grep -i INSTRUMENTATION_STATUS_CODE $DEVICEFARM_LOG_DIR/instrument.log | grep -Ev ': 0|: 1'"
 
  # The post test phase includes are commands that are run after your tests are executed.
  post_test:
    commands:
 
# The artifacts phase lets you specify the location where your tests logs, device logs will be stored.
# And also let you specify the location of your test logs and artifacts which you want to be collected by Device Farm.
# These logs and artifacts will be available through ListArtifacts API in Device Farm.
artifacts:
  # By default, Device Farm will collect your artifacts from following directories
  - $DEVICEFARM_LOG_DIR
 